<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<button id="btn1">按钮1</button>
<button id="btn2">按钮2</button>
<button id="btn3">按钮3</button>
<script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
<script>
  let token = "";
  const axiosInstance = axios.create({
    baseURL: "http://localhost:5000/api",
    timeout: 10000,
    headers: {
      //公共请求头参数
    }
  });
  //请求拦截器
  axiosInstance.interceptors.request.use(
    (config) => {
      if (config.method === "post") {
        //POST默认application/json，若Content-Type非得以下情况需要处理data对象
        config.headers["Content-Type"] = "application/x-www-form-urlencoded";
        config.data = Object.keys(config.data).reduce((prev, key) => {
          return prev + `&${key}=${config.data[key]}`
        }, "").substring(1)
      }
      if (token) config.headers.authorization = "Bearer " + token;
      return config
    },
    //(error)=>{} 没啥用
  );
  //响应拦截器
  axiosInstance.interceptors.response.use(
    response => {
      if (response.data.status === 0) {
        console.log(response.data.data);
        return response.data.data
      } else {
        // 功能失败
        alert(response.data.msg);
        return Promise.reject(response.data.msg);
      }
    },
    error => {
      //console.dir(error);
      const codeMessage = {
        401: '没有权限访问接口',
        403: '禁止访问',
        404: '资源不存在',
        500: '哇哦，故障了，请联系管理员~'
      };
      let errorMessage = "";
      if (error.response) {
        errorMessage = codeMessage[error.response.status] || '未知错误';
      } else {
        if (error.message.indexOf('Network Error') !== -1) {
          errorMessage = '请检查网络连接';
        } else if (error.message.indexOf('timeout') !== -1) {
          errorMessage = '网络太卡了，请连上wifi重试';
        } else {
          errorMessage = '未知错误';
        }
      }
      alert(errorMessage);
      return Promise.reject(errorMessage);
    }
  );
  document.querySelector("#btn1").onclick = function () {
      axiosInstance({
        method: "POST",
        url: "/login",
        data: {username: "admin", password: "admin"}
      }).then(response => {
        console.log("登录成功");
        console.log(response);
        token = response.token;
      })
  };
  document.querySelector("#btn2").onclick = function () {
    axiosInstance({
      method: "GET",
      url: "/category/get"
    }).then((response) => {
      console.log(response);
    })
  };
  document.querySelector("#btn3").onclick = function () {
    axiosInstance({
      method: "POST",
      url: "/category/add",
      data: {categoryName: "鼠标"}
    }).then((response) => {
      console.log(response.data);
    })
  };
</script>
</body>
</html>